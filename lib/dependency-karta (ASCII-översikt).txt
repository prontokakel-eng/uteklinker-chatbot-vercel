â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ðŸ“¦  CHATBOT SPRÃ…KPIPELINE  (2025-10-06)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

USER INPUT
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  gate.js     â”‚   â† fÃ¶rsta fÃ¶rsvarslinjen
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€> ðŸ§© applyWhitelist()        (frÃ¥n wl-bl-filters.js)
    â”‚       â–¸ tillÃ¥ter text som matchar whitelist
    â”‚
    â”œâ”€â”€> ðŸš« applyBlacklist()        (frÃ¥n wl-bl-filters.js)
    â”‚       â–¸ blockerar oÃ¶nskad text
    â”‚
    â”œâ”€â”€> ðŸ¤– checkGibberish()        (frÃ¥n gibberish-filter.js)
    â”‚       â–¸ stoppar nonsenstext
    â”‚
    â”œâ”€â”€> ðŸ§  detectShortLangWord()   (frÃ¥n filters.js)
    â”‚       â–¸ kÃ¤nner igen â€œJaâ€, â€œHiâ€, â€œOkâ€ etc.
    â”‚
    â”œâ”€â”€> ðŸ‘‹ checkGreeting()         (frÃ¥n filters.js)
    â”‚       â–¸ hÃ¤lsningsdetektion, t.ex. â€œHejâ€, â€œHelloâ€
    â”‚
    â”œâ”€â”€> ðŸŒ getIpLang()             (frÃ¥n ip-lang.js)
    â”‚       â–¸ fallback fÃ¶r sprÃ¥k utifrÃ¥n IP eller landskod
    â”‚
    â”œâ”€â”€> ðŸš¦ checkRateLimit()        (frÃ¥n rate-limiter.js)
    â”‚       â–¸ skyddar mot Ã¶verbelastning
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ detectLangCore â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€> ðŸ”¡ detectLangRulesOnly()        (frÃ¥n detect-lang-rules.js)
    â”‚       â–¸ regex, anchors och kortord-lexikon
    â”‚
    â”œâ”€â”€> ðŸ“Š detectLangHeuristicGroup()   (frÃ¥n detect-lang-heuristics.js)
    â”‚       â–¸ teckenfrekvens, grupp-score
    â”‚
    â”œâ”€â”€> ðŸ§© AI-fallback (OpenAI)         (via getOpenAIClient)
    â”‚       â–¸ endast vid lÃ¥g confidence eller UNKNOWN
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Final Lang Decision â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€> Inject FAQ context  (via faq-cache / faq-data)
    â”œâ”€â”€> Send to AI fallback if needed
    â””â”€â”€> Return structured reply { lang, via, confidence }

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ðŸ“ˆ  Pipeline-flÃ¶de:  
  Input â†’ Gate â†’ Filters â†’ Heuristik/Regler â†’ (AI) â†’ Output
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
