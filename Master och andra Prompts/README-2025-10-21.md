# README ‚Äî Dagens arbete (2025-10-09 11:10 UTC)

Den h√§r README'n sammanfattar exakt vad som patchades och hur du verifierar det lokalt.

## √Ñndrade/nya filer
- **/lib/filters-config.js**
  - Ny robust `normArr`, st√∂d f√∂r `sizes.json`, `neutral-words.json`.
  - Offentliga getters: `getWhitelistForLang`, `getBlacklistForLang`, `getNeutralForLang`, `reloadFiltersConfig`.
  - Loggar antal WL/BL/NEU.
- **/lib/wl-bl-filters.js**
  - Normalisering (gemener, `√ó/‚úï‚Üíx`, hoptr√§ngda mellanslag, `" cm"‚Üí"cm"`).
  - `includesSmart`: ordgr√§ns p√• alfabetiska tokens, tolerant substring f√∂r siffror/format.
  - S√§ker ALL‚Äëhantering (alfabetiska ALL‚Äëtermer kr√§ver lokalt spr√•k‚Äëst√∂d; numeriska ALL alltid ok).
- **/lib/gate.js**
  - Kandidat‚Äëspr√•k tidigt (ShortWord‚ÜíIP‚ÜíALL).
  - WL/BL med kandidat‚Äëspr√•k, d√§refter gibberish, shortword, greeting, detectLangCore(+IP), rate‚Äëlimit.
- **/config/sizes.json**
  - Normaliseringskarta (varianter ‚Üí kanoniskt). Anv√§nds indirekt via filters‚Äëkonfig.
- **/config/formats.json**
  - Lista av kanoniska format; mergas in i WL.ALL.
- **/config/neutral-words.json**
  - Neutralord som aldrig ska trigga WL. L√§ser flera JSON‚Äëformat.

## Snabb verifikation
```powershell
npm run test:smoke
```
F√∂rv√§ntat (gr√∂nt):
```
[OK] WL should match 60 x 60 cm
[OK] WL should match 100x100 cm
[OK] BL should block 'viagra'
[OK] WL should not trigger on neutral word
[OK] formats normalization ran
```

## Vanliga f√§llor & fix
- **Ogiltig `package.json`**: se till att JSON √§r giltigt (inga duplicerade toppniv√•‚Äëobjekt).
- **Milj√∂variabler i test**: `tests/.env` prioriteras. `GCP_PRIVATE_KEY` saneras automatiskt (radbrytningar).
- **Cache**: anropa `reloadFiltersConfig()` n√§r du √§ndrar filer i `/config` under test.

## N√§sta steg (rekommenderat)
1. Ut√∂ka **formats.json** med fler kanoniska m√•tt (inkl. mm‚Üícm logik ifylld i WL/normalisering).
2. L√§gg till fler BL‚Äëtermer f√∂r spam/fraud (svag linting p√• plural/singular).
3. K√∂r tortyrsviten med `--limit=200`, `ai-fallback=off` f√∂r ren lexikal stabilitet, sedan `on`.
4. S√§tt upp CI‚Äëjobb som k√∂r smoke + subset av tortyrsviten p√• PR.
## üîé Audit & sanitet

Auditen t√§cker:
- **Dead code** via Knip (`npm run deadcode`)
- **Dependency check** via depcheck (`npm run deps:check`)
- **Importgrafer** (cirklar & orphans) via madge
- **Smoke**-tester (formats, gate, healthz). Vissa smoke kan **skippas** om fil saknas.

K√∂r lokalt:
```bash
npm run audit
